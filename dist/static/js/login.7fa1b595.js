(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["login"],{"3cf1":function(e,t,s){},6527:function(e,t,s){"use strict";var i=s("3cf1"),r=s.n(i);r.a},"7ffe":function(e,t,s){e.exports=s.p+"static/img/cmblogo.07eced91.png"},"914f":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"login-wrap"},[s("div",{staticClass:"ms-login"},[e._m(0),e.isFirstLogin?e._e():s("el-form",{ref:"login",attrs:{model:e.loginParam,rules:e.rules,"label-width":"0px",size:"medium"}},[s("div",{staticClass:"ms-content"},[s("el-form-item",{attrs:{prop:"openId"}},[s("el-input",{attrs:{placeholder:"请输入用户名账号"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitLoginForm()}},model:{value:e.loginParam.openId,callback:function(t){e.$set(e.loginParam,"openId","string"===typeof t?t.trim():t)},expression:"loginParam.openId"}},[s("el-button",{attrs:{slot:"prepend",icon:"iconfont icon-login_user"},slot:"prepend"})],1)],1),s("el-form-item",{attrs:{prop:"password"}},[s("el-input",{attrs:{type:"password",placeholder:"请输入登录密码"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitLoginForm()}},model:{value:e.loginParam.password,callback:function(t){e.$set(e.loginParam,"password","string"===typeof t?t.trim():t)},expression:"loginParam.password"}},[s("el-button",{attrs:{slot:"prepend",icon:"iconfont icon-login_password"},slot:"prepend"})],1)],1),s("el-form-item",[s("el-input",{staticStyle:{width:"60%"},attrs:{placeholder:"验证码"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitLoginForm()}},model:{value:e.loginParam.imageCode,callback:function(t){e.$set(e.loginParam,"imageCode","string"===typeof t?t.trim():t)},expression:"loginParam.imageCode"}},[s("el-button",{attrs:{slot:"prepend",icon:"iconfont icon-login_yzm"},slot:"prepend"})],1),s("el-image",{staticStyle:{"margin-left":"20px"},attrs:{src:e.verifiCodeUrl,alt:"点击重新获取"},on:{click:e.getVerifCodeImage}})],1),s("div",{staticClass:"login-btn"},[s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitLoginForm()}}},[e._v("登录")])],1),s("p",{staticClass:"login-tips"},[e._v("忘记密码时，请联系客户经理重置密码")])],1)]),e.isFirstLogin?s("el-form",{ref:"firstLogin",attrs:{model:e.firstLoginParam,rules:e.firstRules,"label-width":"0px"}},[s("div",{staticClass:"ms-content"},[s("el-form-item",{attrs:{prop:"password"}},[s("el-input",{attrs:{type:"password",placeholder:"请输入密码"},model:{value:e.firstLoginParam.newPassword,callback:function(t){e.$set(e.firstLoginParam,"newPassword",t)},expression:"firstLoginParam.newPassword"}},[s("el-button",{attrs:{slot:"prepend",icon:"iconfont icon-login_password"},slot:"prepend"})],1)],1),s("el-form-item",{attrs:{prop:"confirmPassword"}},[s("el-input",{attrs:{type:"password",placeholder:"请确认密码"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitFirstLoginForm()}},model:{value:e.firstLoginParam.confirmPassword,callback:function(t){e.$set(e.firstLoginParam,"confirmPassword",t)},expression:"firstLoginParam.confirmPassword"}},[s("el-button",{attrs:{slot:"prepend",icon:"iconfont icon-login_password"},slot:"prepend"})],1)],1),s("div",{staticClass:"login-btn"},[s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitFirstLoginForm()}}},[e._v("提交修改")])],1),s("p",{staticClass:"login-tips"},[e._v("请牢记修改的新密码哦~")])],1)]):e._e()],1)])},r=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"ms-title"},[i("img",{staticClass:"ms-title__img",attrs:{src:s("7ffe"),alt:""}}),i("div",{staticClass:"ms-title__text"},[e._v(" | 区块链停车平台")])])}],n=s("967e"),o=s.n(n),a=(s("96cf"),s("3b8d")),l={data:function(){var e=this;return{isFirstLogin:!1,verifiCodeUrl:"",loginParam:{openId:"",password:"",imageCode:"",imageCodeId:""},firstLoginParam:{newPassword:"",confirmPassword:""},rules:{openId:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],verification:[{required:!0,message:"请输入验证码",trigger:"blur"}]},firstRules:{password:[{required:!0,message:"请输入密码",trigger:"blur"}],confirmPassword:[{validator:function(t,s,i){""===s?i(new Error("请再次输入密码")):s!==e.firstLoginParam.newPassword?i(new Error("两次输入密码不一致!")):i()},trigger:"blur"}]}}},created:function(){this.getVerifCodeImage(),this.getVerifCodeImage=this.$help.throttle(this.getVerifCodeImage,500),this.submitLoginForm=this.$help.throttle(this.submitLoginForm,500),this.submitFirstLoginForm=this.$help.throttle(this.submitFirstLoginForm,500)},methods:{getVerifCodeImage:function(){var e=this.$help.randomNum(1,1e3);this.loginParam.imageCodeId=String(e),this.verifiCodeUrl="/api/image-code/init?imageCodeId=".concat(e)},submitLoginForm:function(){var e=Object(a["a"])(o.a.mark((function e(){var t,s,i,r,n,a,l,c;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.loginParam,s=t.openId,i=t.password,r=t.imageCode,n=t.imageCodeId,i=this.$help.base64(i),e.next=4,this.$api.user.login({openId:s,password:i,imageCode:r,imageCodeId:n});case 4:if(a=e.sent,200!==a.status){e.next=17;break}return this.$storage.set("token",a.data),e.next=9,this.$api.user.info();case 9:return l=e.sent,e.next=12,this.$api.user.isFirstLogin();case 12:c=e.sent,200===l.status&&this.$storage.set("role",l.data),0===c.data.isFirstLogin?(this.$message.success(a.message),this.$router.push("/")):(this.$message.info("初次登录请修改密码"),this.isFirstLogin=!0),e.next=19;break;case 17:this.$message.error(a.message),this.getVerifCodeImage();case 19:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),submitFirstLoginForm:function(){var e=Object(a["a"])(o.a.mark((function e(){var t,s,i,r,n,a,l=this;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.firstLoginParam,s=t.newPassword,i=t.confirmPassword,r=this.$storage.getJson("role").id,n=this.loginParam.password,e.next=5,this.$api.user.changePassword({confirmPassword:i,newPassword:s,oldPassword:n,userId:r,type:3});case 5:a=e.sent,200===a.status&&(this.$message.success("".concat(a.message,",1秒后自动登录")),setTimeout((function(){l.$router.push("/")}),500));case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},c=l,m=(s("6527"),s("2877")),d=Object(m["a"])(c,i,r,!1,null,"3e0c3177",null);t["default"]=d.exports}}]);